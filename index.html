 <script>
// --- 省略：前処理、グリッド検出、OCR基本関数はそのまま ---
// ここでは新たに「縦方向/横方向にヒントを切り出す関数」を追加します。

// 横方向に「数字ブロック」を切り出す（行ヒント用）
function sliceHorizontalBlocks(canvas) {
  const w=canvas.width, h=canvas.height;
  const ctx=canvas.getContext("2d");
  const data=ctx.getImageData(0,0,w,h).data;

  let colSum=new Uint32Array(w);
  for(let x=0;x<w;x++){
    for(let y=0;y<h;y++){
      if(data[(y*w+x)*4] < 128) colSum[x]++;
    }
  }

  const blocks=[];
  let inBlock=false, startX=0;

  for(let x=0;x<w;x++){
    if(colSum[x]>0){
      if(!inBlock){ inBlock=true; startX=x; }
    } else {
      if(inBlock){
        blocks.push({x:startX, width:x-startX});
        inBlock=false;
      }
    }
  }
  if(inBlock) blocks.push({x:startX, width:w-startX});

  return blocks.map(b => crop(canvas,b.x,0,b.width,h));
}


// 縦方向に数字ブロックを切り出す（列ヒント用）
function sliceVerticalBlocks(canvas){
  const w=canvas.width, h=canvas.height;
  const ctx=canvas.getContext("2d");
  const data=ctx.getImageData(0,0,w,h).data;

  let rowSum=new Uint32Array(h);
  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      if(data[(y*w+x)*4] < 128) rowSum[y]++;
    }
  }

  const blocks=[];
  let inBlock=false, startY=0;

  for(let y=0;y<h;y++){
    if(rowSum[y]>0){
      if(!inBlock){ inBlock=true; startY=y; }
    } else {
      if(inBlock){
        blocks.push({y:startY, height:y-startY});
        inBlock=false;
      }
    }
  }
  if(inBlock) blocks.push({y:startY, height:h-startY});

  return blocks.map(b => crop(canvas, 0, b.y, w, b.height));
}


// --- メイン処理内に追加 ---
// 列ヒント領域：縦にブロック化して OCR
// 行ヒント領域：横にブロック化して OCR

// メイン処理内の colArea / rowArea を OCR する部分を次のように書き換えます:

const colBlocks = sliceVerticalBlocks(colArea);
let colHints = [];
for(const blk of colBlocks){
  const txt = await ocr(blk);
  if(txt) colHints.push(parseInt(txt,10));
}

const rowBlocks = sliceHorizontalBlocks(rowArea);
let rowHints = [];
for(const blk of rowBlocks){
  const txt = await ocr(blk);
  if(txt){
    // "112" のように続けて読まれた場合は1文字ずつ分割
    txt.split("").forEach(t => rowHints.push(parseInt(t,10)));
  }
}

out.textContent =
  "=== 列ヒント ===\n" + JSON.stringify(colHints) +
  "\n\n=== 行ヒント ===\n" + JSON.stringify(rowHints);
</script>
